<!DOCTYPE html>
 <html>
<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    h1 {
      text-align: center;
    }

    #search {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    #search input {
      width: 300px;
      height: 30px;
      border: 1px solid #ccc;
      padding: 5px;
    }

    #search button {
      width: 100px;
      height: 30px;
      background-color: #0078d4;
      color: white;
      border: none;
      margin-left: 10px;
    }

    #results {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #error {
      color: red;
    }
  </style>
</head>
<body>
  <h1>Ricerca personaggi di Star Wars</h1>
  <div id="search">
    <input type="text" id="name" placeholder="Inserisci il nome del personaggio">
    <button id="submit">Cerca</button>
  </div>
  <div id="results"></div>
  <div id="error"></div>
  <script>
    // URL dell'API GraphQL
    const API_URL = "https://studio.apollographql.com/public/star-wars-swapi/variant/current/home";

    // Elementi del DOM
    const nameInput = document.getElementById("name");
    const submitButton = document.getElementById("submit");
    const resultsDiv = document.getElementById("results");
    const errorDiv = document.getElementById("error");

    // Funzione per creare una query GraphQL
    function createQuery(name) {
      return `
        query allPeople {
          allPeople(name: "${name}") {
            people {
              name
              homeworld {
                name
              }
              species {
                name
              }
              filmConnection {
                films {
                  title
                }
              }
            }
          }
        }
      `;
    }

    // Funzione per eseguire una richiesta fetch all'API GraphQL
    function fetchGraphQL(query) {
      return fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          query: query,
          operationName: "allPeople" // Aggiungere il parametro operationName
        })
      }).then(response => response.json());
    }

    // Funzione per creare una lista con i nomi dei personaggi
    function createList(people) {
      // Creare un elemento ul
      const list = document.createElement("ul");

      // Aggiungere un elemento li per ogni personaggio
      for (let person of people) {
        const item = document.createElement("li");
        item.textContent = person.name;
        list.appendChild(item);
      }

      // Restituire la lista
      return list;
    }

    // Funzione per mostrare i risultati della ricerca
    function showResults(data) {
      // Svuotare il div dei risultati e degli errori
      resultsDiv.innerHTML = "";
      errorDiv.innerHTML = "";

      // Verificare se ci sono errori nell'esecuzione della query
      if (data.errors) {
        // Mostrare gli errori nel div degli errori
        errorDiv.textContent = "Si sono verificati i seguenti errori:";
        const errorList = document.createElement("ul");
        for (let error of data.errors) {
          const errorItem = document.createElement("li");
          errorItem.textContent = error.message;
          errorList.appendChild(errorItem);
        }
        errorDiv.appendChild(errorList);
      } else {
        // Verificare se ci sono personaggi corrispondenti
        if (data.data.allPeople.people.length > 0) {
          // Creare e aggiungere una lista con i nomi dei personaggi
          const list = createList(data.data.allPeople.people);
          resultsDiv.appendChild(list);
        } else {
          // Mostrare un messaggio di errore
          resultsDiv.textContent = "Nessun personaggio trovato con questo nome.";
        }
      }
    }

    // Aggiungere un listener al pulsante di submit
    submitButton.addEventListener("click", function() {
      // Ottenere il valore dell'input
      const name = nameInput.value;

      // Verificare se l'input Ã¨ vuoto
      if (name === "") {
        // Mostrare un messaggio di errore
        resultsDiv.textContent = "Per favore, inserisci il nome di un personaggio.";
      } else {
        // Creare una query GraphQL con il nome
        const query = createQuery(name);

        // Eseguire una richiesta fetch all'API GraphQL con la query
        fetchGraphQL(query)
          .then(data => showResults(data)) // Mostrare i risultati
          .catch(error => console.error(error)); // Gestire gli errori
      }
    });
  </script>
</body>
</html>

